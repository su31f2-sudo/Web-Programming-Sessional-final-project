<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Enhanced Notes App</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4bb543;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 300px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo-icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .logo h1 {
            font-size: 22px;
            font-weight: 600;
        }

        .ai-features {
            margin-top: 20px;
        }

        .ai-features h3 {
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 500;
            opacity: 0.9;
        }

        .ai-btn {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ai-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .ai-btn i {
            margin-right: 10px;
            font-size: 18px;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .search-bar {
            display: flex;
            width: 100%;
            max-width: 500px;
        }

        .search-bar input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: 8px 0 0 8px;
            font-size: 16px;
        }

        .search-bar button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
        }

        .add-note-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background 0.3s ease;
        }

        .add-note-btn:hover {
            background: var(--secondary);
        }

        .add-note-btn i {
            margin-right: 8px;
        }

        /* Notes Grid */
        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .note-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            border-left: 4px solid var(--accent);
        }

        .note-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .note-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .note-date {
            font-size: 12px;
            color: var(--gray);
        }

        .note-actions {
            display: flex;
            gap: 10px;
        }

        .note-action {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 16px;
            transition: color 0.3s ease;
        }

        .note-action.edit:hover {
            color: var(--primary);
        }

        .note-action.delete:hover {
            color: var(--danger);
        }

        .note-content {
            color: var(--gray);
            font-size: 14px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Note Editor */
        .note-editor {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .editor-title {
            font-size: 24px;
            font-weight: 600;
        }

        .editor-actions {
            display: flex;
            gap: 10px;
        }

        .editor-btn {
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-btn {
            background: var(--success);
            color: white;
            border: none;
        }

        .save-btn:hover {
            background: #3a9c35;
        }

        .cancel-btn {
            background: var(--light-gray);
            color: var(--dark);
            border: 1px solid var(--gray);
        }

        .cancel-btn:hover {
            background: #d8d8d8;
        }

        .editor-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-group textarea {
            min-height: 200px;
            resize: vertical;
        }

        /* AI Output Section */
        .ai-output {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
        }

        .ai-output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .ai-output-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }

        .ai-output-content {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            min-height: 100px;
            border-left: 4px solid var(--accent);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 15px;
            }

            .notes-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="container">
        <!-- Sidebar with AI Features -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-brain"></i></div>
                <h1>AI Notes</h1>
            </div>

            <div class="ai-features">
                <h3>AI Tools</h3>
                <button class="ai-btn" id="summarize-btn">
                    <i class="fas fa-file-contract"></i>
                    <span>Summarize Note</span>
                </button>
                <button class="ai-btn" id="bulletpoints-btn">
                    <i class="fas fa-list-ul"></i>
                    <span>Convert to Bullet Points</span>
                </button>
                <button class="ai-btn" id="questions-btn">
                    <i class="fas fa-question-circle"></i>
                    <span>Generate Study Questions</span>
                </button>
            </div>

            <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.2);">
                <div style="font-size: 14px; opacity: 0.8;">
                    <p>AI Notes turns your regular notes into intelligent study tools with the power of AI.</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="search-bar">
                    <input type="text" placeholder="Search your notes...">
                    <button><i class="fas fa-search"></i></button>
                </div>
                <button class="add-note-btn" id="add-note-btn">
                    <i class="fas fa-plus"></i>
                    <span>New Note</span>
                </button>
            </div>

            <!-- Notes Grid -->
            <div class="notes-grid" id="notes-grid">
                <!-- Note cards will be dynamically inserted here -->
                <div class="note-card" data-id="1">
                    <div class="note-header">
                        <div>
                            <div class="note-title">Machine Learning Basics</div>
                            <div class="note-date">Created: Oct 12, 2023</div>
                        </div>
                        <div class="note-actions">
                            <button class="note-action edit"><i class="fas fa-edit"></i></button>
                            <button class="note-action delete"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <div class="note-content">
                        Machine learning is a subset of artificial intelligence that focuses on algorithms that can
                        learn from data without being explicitly programmed. There are three main types: supervised
                        learning, unsupervised learning, and reinforcement learning.
                    </div>
                </div>

                <div class="note-card" data-id="2">
                    <div class="note-header">
                        <div>
                            <div class="note-title">Neural Networks</div>
                            <div class="note-date">Created: Oct 10, 2023</div>
                        </div>
                        <div class="note-actions">
                            <button class="note-action edit"><i class="fas fa-edit"></i></button>
                            <button class="note-action delete"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <div class="note-content">
                        Neural networks are computing systems inspired by the human brain. They consist of layers of
                        interconnected nodes (neurons) that process information. Deep learning uses neural networks with
                        many layers (deep neural networks).
                    </div>
                </div>

                <div class="note-card" data-id="3">
                    <div class="note-header">
                        <div>
                            <div class="note-title">Natural Language Processing</div>
                            <div class="note-date">Created: Oct 5, 2023</div>
                        </div>
                        <div class="note-actions">
                            <button class="note-action edit"><i class="fas fa-edit"></i></button>
                            <button class="note-action delete"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <div class="note-content">
                        NLP is a field of AI that focuses on the interaction between computers and human language. It
                        involves tasks like text classification, sentiment analysis, machine translation, and named
                        entity recognition.
                    </div>
                </div>
            </div>

            <!-- Note Editor (Initially Hidden) -->
            <div class="note-editor" id="note-editor" style="display: none;">
                <div class="editor-header">
                    <div class="editor-title" id="editor-title">New Note</div>
                    <div class="editor-actions">
                        <button class="editor-btn cancel-btn" id="cancel-btn">Cancel</button>
                        <button class="editor-btn save-btn" id="save-btn">Save Note</button>
                    </div>
                </div>

                <div class="editor-form">
                    <div class="form-group">
                        <label for="note-title">Title</label>
                        <input type="text" id="note-title" placeholder="Enter note title">
                    </div>

                    <div class="form-group">
                        <label for="note-content">Content</label>
                        <textarea id="note-content" placeholder="Write your note here..."></textarea>
                    </div>
                </div>
            </div>

            <!-- AI Output Section -->
            <div class="ai-output" id="ai-output" style="display: none;">
                <div class="ai-output-header">
                    <div class="ai-output-title" id="ai-output-title">AI Summary</div>
                    <button class="editor-btn" id="copy-ai-output"
                        style="background: var(--accent); color: white;">Copy</button>
                </div>
                <div class="ai-output-content" id="ai-output-content">
                    <!-- AI generated content will appear here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --------------------------
        // SELECT DOM ELEMENTS
        // --------------------------
        const noteEditor = document.getElementById("note-editor");
        const noteTitle = document.getElementById("note-title");
        const noteContent = document.getElementById("note-content");
        const notesGrid = document.getElementById("notes-grid");

        const addNoteBtn = document.getElementById("add-note-btn");
        const cancelBtn = document.getElementById("cancel-btn");
        const saveBtn = document.getElementById("save-btn");

        const summarizeBtn = document.getElementById("summarize-btn");
        const bulletpointsBtn = document.getElementById("bulletpoints-btn");
        const questionsBtn = document.getElementById("questions-btn");

        const aiOutput = document.getElementById("ai-output");
        const aiOutputTitle = document.getElementById("ai-output-title");
        const aiOutputContent = document.getElementById("ai-output-content");
        const copyAIOutput = document.getElementById("copy-ai-output");

        // --------------------------
        // STATE
        // --------------------------
        const API_BASE = 'http://localhost:5000';
        let currentUserId = 1;
        let isEditing = false;
        let currentNoteId = null;

        // --------------------------
        // OPEN EDITOR
        // --------------------------
        function openEditor(noteId = null) {
            noteEditor.style.display = "block";
            aiOutput.style.display = "none";

            if (noteId) {
                isEditing = true;
                currentNoteId = noteId;

                document.getElementById("editor-title").textContent = "Edit Note";

                fetch(`${API_BASE}/getNote/${noteId}`)
                    .then(res => res.json())
                    .then(note => {
                        noteTitle.value = note.title;
                        noteContent.value = note.content;
                    })
                    .catch(() => alert("Error loading note"));
            } else {
                isEditing = false;
                currentNoteId = null;
                document.getElementById("editor-title").textContent = "New Note";
                noteTitle.value = "";
                noteContent.value = "";
            }

            noteEditor.scrollIntoView({ behavior: "smooth" });
        }

        // --------------------------
        // CLOSE EDITOR
        // --------------------------
        function closeEditor() {
            noteEditor.style.display = "none";
        }

        // --------------------------
        // SAVE OR UPDATE NOTE
        // --------------------------
        function saveNote() {
            const title = noteTitle.value.trim();
            const content = noteContent.value.trim();

            if (!title || !content) {
                alert("Please fill in both title and content.");
                return;
            }

            if (isEditing) {
                // UPDATE
                fetch(`${API_BASE}/updateNote/${currentNoteId}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ title, content })
                })
                    .then(res => res.json())
                    .then(result => {
                        if (result.success) {
                            loadNotes();
                            closeEditor();
                        } else alert("Error updating note");
                    })
                    .catch(() => alert("Error updating note"));
            } else {
                // CREATE
                fetch(`${API_BASE}/createNote`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ userId: currentUserId, title, content })
                })
                    .then(res => res.json())
                    .then(result => {
                        if (result.success) {
                            loadNotes();
                            closeEditor();
                        } else alert("Error creating note");
                    })
                    .catch(() => alert("Error creating note"));
            }
        }

        // --------------------------
        // DELETE NOTE
        // --------------------------
        function deleteNote(id) {
            if (!confirm("Delete this note?")) return;

            fetch(`${API_BASE}/deleteNote/${id}`, { method: "DELETE" })
                .then(res => res.json())
                .then(result => {
                    if (result.success) {
                        loadNotes();
                        closeEditor();
                    } else alert("Error deleting note");
                })
                .catch(() => alert("Error deleting note"));
        }

        // --------------------------
        // LOAD ALL NOTES
        // --------------------------
        function loadNotes() {
            fetch(`${API_BASE}/getNotes/${currentUserId}`)
                .then(res => res.json())
                .then(notes => {
                    notesGrid.innerHTML = "";

                    notes.forEach(note => {
                        const div = document.createElement("div");
                        div.className = "note-card";
                        div.dataset.id = note.noteId;

                        const formattedDate = new Date(note.updatedAt).toLocaleDateString("en-US", {
                            year: "numeric",
                            month: "short",
                            day: "numeric"
                        });

                        div.innerHTML = `
                        <div class="note-header">
                            <div>
                                <div class="note-title">${note.title}</div>
                                <div class="note-date">Updated: ${formattedDate}</div>
                            </div>
                            <div class="note-actions">
                                <button class="note-action edit"><i class="fas fa-edit"></i></button>
                                <button class="note-action delete"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        <div class="note-content">${note.content}</div>
                    `;

                        // Edit
                        div.querySelector(".edit").onclick = (e) => {
                            e.stopPropagation();
                            openEditor(note.noteId);
                        };

                        // Delete
                        div.querySelector(".delete").onclick = (e) => {
                            e.stopPropagation();
                            deleteNote(note.noteId);
                        };

                        // Clicking card opens editor
                        div.onclick = () => openEditor(note.noteId);

                        notesGrid.appendChild(div);
                    });
                });
        }

        // --------------------------
        // AI PROCESSING
        // --------------------------
        function processNoteWithAI(type) {
            if (!noteContent.value.trim()) {
                alert("Please select or write a note first.");
                return;
            }

            const noteId = currentNoteId || 0;
            const content = noteContent.value;

            const titles = {
                summary: "AI Summary",
                bullet_points: "Bullet Points",
                study_questions: "Study Questions"
            };

            aiOutputTitle.textContent = titles[type] || "AI Output";
            aiOutputContent.innerHTML = `<div style="text-align:center;"><i class="fas fa-spinner fa-spin"></i> Processing...</div>`;
            aiOutput.style.display = "block";

            fetch(`${API_BASE}/processNote`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ noteId, processType: type, content })
            })
                .then(res => res.json())
                .then(result => {
                    if (result.success) {
                        aiOutputContent.innerHTML = result.processedContent.replace(/\n/g, "<br>");
                    } else {
                        aiOutputContent.innerHTML = "AI Error processing note";
                    }
                })
                .catch(() => {
                    aiOutputContent.innerHTML = "AI connection error";
                });
        }

        // --------------------------
        // COPY AI OUTPUT
        // --------------------------
        copyAIOutput.onclick = () => {
            navigator.clipboard.writeText(aiOutputContent.innerText);
            alert("Copied!");
        };

        // --------------------------
        // EVENT LISTENERS
        // --------------------------
        addNoteBtn.onclick = () => openEditor();
        cancelBtn.onclick = () => closeEditor();
        saveBtn.onclick = () => saveNote();

        summarizeBtn.onclick = () => processNoteWithAI("summary");
        bulletpointsBtn.onclick = () => processNoteWithAI("bullet_points");
        questionsBtn.onclick = () => processNoteWithAI("study_questions");

        // --------------------------
        // LOAD NOTES ON PAGE LOAD
        // --------------------------
        document.addEventListener("DOMContentLoaded", loadNotes);
    </script>

</body>

</html>